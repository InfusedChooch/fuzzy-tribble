<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    th {
      background-color: #e4e4e4 !important;
      color: #000 !important;
    }
    table { width: 100%; margin-bottom: 2em; border-collapse: collapse; }
    th, td { padding: .5em; border: 1px solid #ccc; text-align: center; }
    .pending_start { background: #cfe2ff; }
    .pending_return { background: #ffedc7; }
    .active { background: #ffd6d6; }
    .collapsible { background: #eee; cursor: pointer; padding: 10px; text-align: left; width: 100%; border: none; font-size: 1.1em; margin-top: 10px; }
    .content { display: block; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Shared styled clock + period -->
  <div id="custom-clock" class="custom-clock">Loading time‚Ä¶</div>
  <div class="period" id="period">Checking current period...</div>

  <nav>
    <a href="{{ url_for('auth.admin_logout') }}">Logout</a> |
    <a href="{{ url_for('admin.admin_pass_history') }}">Pass History</a> |
    <a href="{{ url_for('admin.admin_weekly_summary') }}">View Weekly Summary ‚Üí</a> |
    <button onclick="location.reload()">üîÑ Refresh All</button>
  </nav>

  <small style="display:block; margin-top: 5px; font-size: 0.9em;">
    üìç <strong>Open Stations:</strong>
    {% for r in active_rooms %}
      <code>{{ r }}</code>{% if not loop.last %}, {% endif %}
    {% else %}
      <em>None</em>
    {% endfor %}
  </small>

  <!-- Admin Tools -->
  <h2>Quick Admin Tools</h2>
  <div style="display: flex; gap: 2em; align-items: flex-end; flex-wrap: wrap;">
    <!-- Pop Out Station -->
    <form id="station-popout-form" onsubmit="openStationView(event)" style="flex: 1; min-width: 260px;">
      <label><strong>Pop Out Station</strong></label><br>
      <input list="stations" id="station-selector" placeholder="Bathroom, Nurse, etc." required>
      <datalist id="stations">
        <option value="Bathroom">
        <option value="Nurse">
        <option value="Library">
        <option value="Office">
      </datalist>
      <button type="submit">Open Station Window</button>
    </form>

    <!-- Create Override Pass -->
    <form id="create-pass-form">
      <input type="text" id="student_id" placeholder="Student ID" required>
      <input type="text" id="override_room" placeholder="Room Out (e.g., 101)">
      <input type="text" id="override_period" placeholder="Period (e.g., 3)">
      <button type="submit">Create Override</button>
    </form>
  </div>

  <!-- Collapse All -->
  <button id="toggle-all" style="margin: 1em 0;">üîΩ Collapse All</button>

  <!-- Collapsible: Pending All (merged) -->
  <button class="collapsible">Pending Requests</button>
  <div class="content">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Student</th>
          <th>Room (Requested From)</th>
          <th>Time</th>
          <th>Type</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="pending-table"></tbody>
    </table>
  </div>

  <!-- Collapsible: Active Passes -->
  <button class="collapsible">Active Passes</button>
  <div class="content">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Date</th>
          <th>Period</th>
          <th>Room Out</th>
          <th>Station In</th>
          <th>Station Out</th>
          <th>Room In</th>
          <th>Total</th>
          <th>Hallway</th>
          <th>Station</th>
          <th>Action</th>
          <th>Note</th>
          <th>Status / Override</th>
        </tr>
      </thead>
      <tbody id="passes-table"></tbody>
    </table>
  </div>

  <!-- Recently Returned -->
  <h2>Recently Returned Passes</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Date</th>
        <th>Period</th>
        <th>Room Out</th>
        <th>Station In</th>
        <th>Station Out</th>
        <th>Room In</th>
        <th>Total</th>
        <th>Hallway</th>
        <th>Station</th>
        <th>Note</th>
        <th>Override</th>
      </tr>
    </thead>
    <tbody>
      {% for p in recent_returns %}
      <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.student_name }}</td>
        <td>{{ p.date }}</td>
        <td>{{ p.period }}</td>
        <td>{{ p.room_out }}</td>
        <td>{{ p.station_in }}</td>
        <td>{{ p.station_out }}</td>
        <td>{{ p.room_in }}</td>
        <td>{{ p.elapsed }}</td>
        <td>{{ p.hallway_time }}</td>
        <td>{{ p.station_time }}</td>
        <td>{{ p.note }}</td>
        <td>{{ p.override }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Change Admin Password -->
  <h2>Change Admin Password</h2>
  <form id="change-password-form">
    <input type="password" id="current_pass" placeholder="Current Password" required>
    <input type="password" id="new_pass" placeholder="New Password" required>
    <input type="password" id="confirm_pass" placeholder="Confirm New Password" required>
    <button type="submit">Change Password</button>
    <p id="password-msg"></p>
  </form>

  <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>
