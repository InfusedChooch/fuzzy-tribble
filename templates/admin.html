<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    table { width: 100%; margin-bottom: 2em; border-collapse: collapse; }
    th, td { padding: .5em; border: 1px solid #ccc; text-align: center; }
    .pending_start { background: #cfe2ff; }
    .pending_return { background: #ffedc7; }
    .active { background: #ffd6d6; }
  </style>
</head>
<body>
  <h1>Admin Panel — Station: {{ admin_station }}</h1>

  <nav>
    <a href="{{ url_for('auth.admin_logout') }}">Logout</a> |
    <a href="{{ url_for('admin.set_station') }}">Set This Console as Station</a> |
    <a href="{{ url_for('admin.admin_pass_history') }}">Pass History</a> |
    <a href="{{ url_for('report.admin_report_csv') }}">Download Weekly&nbsp;CSV</a>
  </nav>

  <h3>Pop Out Station View</h3>
  <form id="station-popout-form" onsubmit="openStationView(event)">
    <select id="station-selector">
      {% for room in station_rooms %}
        <option value="{{ room }}">{{ room }}</option>
      {% endfor %}
    </select>
    <button type="submit">Open Station Window</button>
  </form>

  <!-- ------------------------------------------------------------ -->
  <h2>Create Override Pass</h2>
  <form id="create-pass-form">
    <input type="text" id="student_id" placeholder="Student ID" required>
    <button type="submit">Create Override</button>
  </form>

  <!-- ------------------------------------------------------------ -->
  <h2>Live Pass Table</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>Student</th><th>Room</th><th>Out</th>
        <th>Station&nbsp;OUT</th><th>Station&nbsp;IN</th><th>Last</th>
        <th>Time</th><th>Note</th><th>Override</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="passes-table">
      <!-- Filled by admin.js -->
    </tbody>
  </table>

  <!-- ------------------------------------------------------------ -->
  <h2>Weekly Summary (Mon‑Fri)</h2>
  <table>
    <thead>
      <tr>
        <th>Student</th><th>ID</th><th>M&nbsp;T&nbsp;W&nbsp;T&nbsp;F&nbsp;(min)</th>
        <th>#&nbsp;>5&nbsp;min</th><th>#&nbsp;>10&nbsp;min</th><th>Override?</th>
      </tr>
    </thead>
    <tbody>
    {% for row in report_data %}
      <tr>
        <td>{{ row.student_name }}</td>
        <td>{{ row.student_id }}</td>
        <td>{{ row.weekly_report }}</td>
        <td>{{ row.passes_over_5_min }}</td>
        <td>{{ row.passes_over_10_min }}</td>
        <td>{{ row.used_override }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <!-- ------------------------------------------------------------ -->
  <h2>Change Admin Password</h2>
  <form id="change-password-form">
    <input type="password" id="current_pass" placeholder="Current Password" required>
    <input type="password" id="new_pass" placeholder="New Password" required>
    <input type="password" id="confirm_pass" placeholder="Confirm New Password" required>
    <button type="submit">Change Password</button>
    <p id="password-msg"></p>
  </form>

  <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
  <script>
    function openStationView(event) {
      event.preventDefault();
      const station = document.getElementById('station-selector').value;
      const url = `/station_view/${station}`;
      window.open(url, '_blank', 'width=800,height=600');
    }
  </script>
</body>
</html>
